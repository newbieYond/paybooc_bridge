<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div class="container">
        <h1>동적 버튼 생성 예제</h1>
        <div id="buttonContainer" class="button-container">
            <!-- 버튼들이 여기에 동적으로 생성됩니다 -->
        </div>

        <div class="result">
            <h3>실행 결과:</h3>
            <div id="output">버튼을 클릭해보세요!</div>
        </div>
    </div>
</body>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f5f5f5;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
    }

    .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }

    .dynamic-btn {
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: linear-gradient(45deg, #007bff, #0056b3);
        color: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .dynamic-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .dynamic-btn:active {
        transform: translateY(0);
    }

    .result {
        margin-top: 30px;
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #007bff;
        min-height: 50px;
    }

    .result h3 {
        margin-top: 0;
        color: #333;
    }

    #output {
        color: #666;
        font-size: 14px;
    }
</style>
<script>
    // 버튼 동적 생성 함수
    function createButtons() {
        const container = document.getElementById('buttonContainer');
        container.innerHTML = ''; // 기존 버튼들 제거

        pluginService.getItems().forEach((item) => {
            const itemName = item.name
            item.items.forEach((item) => {
                const btn = document.createElement('button');
                btn.textContent = itemName + " - " + item.buttonText;
                btn.className = 'dynamic-btn';
                btn.onclick = item.onClick
                container.appendChild(btn);
            })
        })
    }

    // 페이지 로드시 버튼 생성
    document.addEventListener('DOMContentLoaded', function () {
        createButtons();
    });

    const pluginService = (function () {
        const callbacks = {}
        const items = []
        let requestSeed = 0
        let dataStore = {}
        return ({
            postCommand: function (command, callback) {
                if (!command.callback) {
                    command.callback = this.nextcallback(command)
                }
                if (callback) {
                    callbacks[command.callback] = callback
                }
                payboocBridgeHandler(command)
            },
            nextcallback: function (command) {
                return command.category + "." + command.api + "." + requestSeed++
            },
            addItem: function (item) {
                items.push(item)
            },
            getItems: function () {
                return items
            }
        })
    })()

    const commIfScript = {
        onBackPressed: function () {
            var command = {
                category: "Navi",
                api: "closeWebView",
                params: JSON.stringify({})
            }
            payboocBridgeHandler(command)
        }
    }

    function payboocBridgeHandler(command) {
        if (isIOS()) {
            // IOS
            document.getElementById('output').innerHTML = `<strong>메시지:</strong> ${JSON.stringify(command)}`;
            webkit.messageHandlers.payboocBridge.postMessage(JSON.stringify(command)) // ios

        } else if (isAndroid()) {
            // Android
            document.getElementById('output').innerHTML = `<strong>메시지:</strong> ${JSON.stringify(command)}`;
            window.payboocBridge.postMessage(JSON.stringify(command)) // android
        } else {
            document.getElementById('output').innerHTML = `<strong>페이북앱에서 열기:</strong> ${JSON.stringify(command)}`;
            window.location = "ispmobile://callWebView=" + encodeURIComponent("https://cdpn.io/pen/debug/XJbbPmL?authentication_hash=LQkExWpmWJPA")
        }
    }

    function isIOS() {
        return window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.payboocBridge
    }

    function isAndroid() {
        return window.payboocBridge
    }

    // MARK: - 콜백 처리
    function appBridgeCallbackListener(result) {
        console.log("appBridgeCallbackListener result=" + JSON.stringify(result, null, 4))
        alert("callback: " + result.callback + "\nresultCode: " + result.resultCode + "\nparams : " + JSON.stringify(JSON.parse(result.params), null, 4))
    }

    // MARK: - Back Event
    function appEventListener(params) {
        if (params.event == "back") {
            var command = {
                category: "Navi",
                api: "closeWebView",
                params: JSON.stringify({})
            }
            payboocBridgeHandler(command)
        }
    }

    // MARK: - webviewReady
    function webviewReady() {
        var command = {
            category: "Navi",
            api: "webviewReady",
            params: JSON.stringify({})
        }
        pluginService.postCommand(command)
    }
    webviewReady()

    // MARK: - 브릿지 함수들 추가
    function plugin(name, items) {
        pluginService.addItem({ "name": name, "items": items })
    }

    // MARK: - 07. Comm
    plugin("07. Comm", [
        {
            viewType: "button",
            buttonText: "showToastMessage",
            onClick: function () {
                var command = {
                    category: "Comm",
                    api: "showToastMessage",
                    params: JSON.stringify({
                        message: "메세지",
                        iconType: "ico-caution",
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "setOverseaQR - C (중국 본토)",
            onClick: function () {
                var command = {
                    category: "Comm",
                    api: "setOverseaQR",
                    params: JSON.stringify({
                        value: "C"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "setOverseaQR - N (중국 외)",
            onClick: function () {
                var command = {
                    category: "Comm",
                    api: "setOverseaQR",
                    params: JSON.stringify({
                        value: "N"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "setOverseaQR - M (말레이시아)",
            onClick: function () {
                var command = {
                    category: "Comm",
                    api: "setOverseaQR",
                    params: JSON.stringify({
                        value: "M"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "setOverseaQR - T (태국)",
            onClick: function () {
                var command = {
                    category: "Comm",
                    api: "setOverseaQR",
                    params: JSON.stringify({
                        value: "T"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "setOverseaQR - 국내",
            onClick: function () {
                var command = {
                    category: "Comm",
                    api: "setOverseaQR",
                    params: JSON.stringify({
                        value: ""
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "getOverseaQR",
            onClick: function () {
                var command = {
                    category: "Comm",
                    api: "getOverseaQR",
                    params: JSON.stringify({})
                }
                pluginService.postCommand(command)
            },
        }
    ])

    // MARK: - 08. Permission
    plugin("08. Permission", [
        {
            viewType: "button",
            buttonText: "checkPermission(location)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "checkPermission",
                    params: JSON.stringify({
                        "type": "location"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "requestPermission(location)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "requestPermission",
                    params: JSON.stringify({
                        "type": "location"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "checkPermission(osPush)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "checkPermission",
                    params: JSON.stringify({
                        "type": "osPush"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "requestPermission(osPush)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "requestPermission",
                    params: JSON.stringify({
                        "type": "osPush"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "checkPermission(tracking)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "checkPermission",
                    params: JSON.stringify({
                        "type": "tracking"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "requestPermission(tracking)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "requestPermission",
                    params: JSON.stringify({
                        "type": "tracking"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "checkPermission(camera)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "checkPermission",
                    params: JSON.stringify({
                        "type": "camera"
                    })
                }
                pluginService.postCommand(command)
            },
        },
        {
            viewType: "button",
            buttonText: "requestPermission(camera)",
            onClick: function () {
                var command = {
                    category: "Permission",
                    api: "requestPermission",
                    params: JSON.stringify({
                        "type": "camera"
                    })
                }
                pluginService.postCommand(command)
            },
        }

    ])
</script>

</html>
